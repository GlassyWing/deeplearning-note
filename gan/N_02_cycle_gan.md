# CycleGAN

## 架构

## 损失函数

### 鉴定器损失

鉴定器的目标是训练出一个函数$D$能够识别出伪图和真图。

1. 对于真图$ y \sim P(Y) $，我们期望 $D(y)$能输出1.
2. 对于生成器生成的伪图 $ \{ \hat{y} \sim P(G(X)) | x \sim P(X) \} $, 我们期望 $ D(\hat{y}) $ 能输出0.

* 目标函数

$$ MIN \{ E_{y \sim p(y)}[(D(y) -1)^2] + E_{x \sim p(x) }[(D(G(x)) - 0) ^ 2] \}  $$

* 损失函数为MSE

$$ \frac{1}{m} \sum_{i=1}^m(y_i - \hat{y_i})^2 $$

### 生成器损失

生成器的目标是生成让鉴定器信以为真的图片。

* 目标函数

$$ MIN \{ E_{x \sim p(x)} [(D(G(X)) - 1) ^ 2] \} $$

* 损失函数为MSE

$$ \frac{1}{m} \sum_{i=1}^m(y_i - \hat{y_i})^2 $$

### 循环一致性损失

为了让反向生成器能够还原正向生成器生成的图片，保证它们的一致性，引入循环一致性损失：

* 目标函数

$$ MIN\{E_{x \sim p(x)}[|F(G(x)) - x|] + E_{y \sim p(y)}[|G(F(y)) - y|]\} $$

* 损失函数为MAE

$$ \frac{1}{m} \sum_{i=1}^m|y_i - \hat{y_i}| $$

### 身份映射损失

* 原因

当使用模型 $  x → G(x) → F(G(x)) ≈ x. $ 进行训练时，中间变量G(x)代表生成的图像，然而生成图像可能和原图色彩有着很大区别。为了反映出原图像的色彩，那么应该有：

$$ F(x) ≈ x $$

即反向生成器不止能将生成的图像还原为原图像，**还应将原图像还原为原图**。将原图还原为原图的特性迫使前向生成器生成与原图色彩特性相似的图片。

* 目标函数

$$ MIN\{E_{y \sim p(y)}[ |G(y) - y|] + E_{x \sim p(x)}[|F(x) - x|] \} $$

* 损失函数为MAE

$$ \frac{1}{m} \sum_{i=1}^m|y_i - \hat{y_i}| $$

## 训练

### 训练鉴定器

训练鉴定器时，为了减少模型的不稳定性，使用一个图像缓存存储前50词生成器生成的图像。

### 训练生成器

略